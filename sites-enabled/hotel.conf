# Nginx Configuration 

server {
    listen 80;
    server_name hotel.mirisafar.com 2.180.44.137;

    # 1. پروکسی کردن تمام درخواست‌های API به Django (پورت 8000)
    # توجه: درخواست‌های API شما اکنون باید با /api/ شروع شوند (همانطور که در coreService.ts تنظیم کردید)
    # اما برخی از URLها در جنگو به صورت /hotels/api/ یا /pricing/api/ تعریف شده‌اند.
    # ما مسیرهای اصلی API را به صورت صریح پروکسی می‌کنیم.

    # راهکار بهینه:
    # تمام URLهایی که مربوط به API هستند را در یک بلاک مشترک قرار می‌دهیم 
    # و مطمئن می‌شویم که در فرانت‌اند از همان baseURL استفاده می‌شود.

    # مسیرهای مورد نیاز:
    # /api/auth/login/
    # /core/api/settings/
    # /hotels/api/cities/
    # /pricing/api/search/

    # ما می‌توانیم تمام ترافیک غیر فرانت‌اند را به پورت ۸۰۰۰ بفرستیم:
    location ~ ^/(api|core/api|hotels/api|pricing/api|reservations|agencies)/ {
        proxy_pass http://127.0.0.1:8000;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 2. پروکسی کردن سایر ترافیک (فرانت‌اند - پورت 3000)
    location / {
        proxy_pass http://127.0.0.1:3000;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
